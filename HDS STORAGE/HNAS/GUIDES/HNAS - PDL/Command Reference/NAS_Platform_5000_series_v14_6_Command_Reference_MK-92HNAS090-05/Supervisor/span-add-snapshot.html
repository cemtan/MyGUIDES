<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>span-add-snapshot</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
  <style type="text/css">
  <!--
  @page { size: 8.27in 11.69in }
  H1  { font-family: "Verdana", sans-serif }
  H2  { font-family: "Verdana", sans-serif }
  H3  { font-family: "Verdana", sans-serif }
  H4  { font-family: "Verdana", sans-serif }
  P   { font-family: "Verdana", sans-serif; font-size: 11pt; margin-left: 40px; }
  PRE { font-family: "Courier", monospace;  font-size: 12pt; margin-left: 40px; }
  DT  { font-family: "Verdana", sans-serif; font-size: 11pt; margin-left: 40px; }
  LI  { font-family: "Verdana", sans-serif; font-size: 11pt; margin-left: 40px; }
  -->
  </style>

</head>
<body style="background-color: white">
<!--Start header -->
<!-- html created: 2023-03-07 10:21:49 +0000 oemId: 1 -->
<h1>span-add-snapshot</h1>
<p>Detect a snapshot of a span on newly created and licensed snapshot SDs</p>
<h1>Syntax</h1>
<pre>span-add-snapshot &lt;span-base-name&gt; &lt;snapshot-name&gt; &lt;system-drives-see-&#39;man sd-spec&#39;&gt;
Alias:       mksnap
</pre>

<h1>Description</h1>
<p>Tells the server to detect a newly-created storage-based snapshot of a span and its filesystems.  These snapshots are created by products such as the Hitachi Thin Image (HTI) or Copy-On-Write (CoW) Snapshot features.</p>
<p>Specify a new snapshot name, followed by all the SDs that make up the new snapshot.  Before a new snapshot is created, all file systems on the source (old) snapshot must be unmounted.</p>
<h2>HOW TO USE THIS COMMAND</h2>
<p>This section explains how to create and detect a new snapshot.</p>
<ul>
<li>If the existing span is not yet in snapshot mode, use 'span-enable-snapshots' to make it so, and prepare your storage to use storage-based snapshots by following the instructions in the appropriate user guide.  This step need be performed only once.</li>
<li>Use 'sd-list --hdp &lt;span-instance-name&gt;' to determine the names that the storage uses for the SDs that are currently in the span.</li>
<li>In the next step, you will create snapshot LUs (V-Vols) that are copies of a specific source snapshot.  Unmount all the source snapshot's file systems now.</li>
<li>Use your storage configurator, such as Storage Navigator or Hitachi Command Suite, to create new V-Vols.  They should have exactly the same capacity as the existing SDs.</li>
<li>Place all the new V-Vols into a single consistency group.</li>
<li>Use your storage configurator to pair and then immediately split the pairs.  The first step ensures that the V-Vols contain the same information as the P-Vols, the master copies of the SDs.  The second step makes it possible to do I/O and mount file systems.</li>
<li>If desired, remount file systems on the source snapshot.</li>
<li>Depending on the configuration of your storage, it may be necessary to run 'scsi-refresh' to enable the server to detect the new V-Vols.</li>
<li>Wait a few tens of seconds until 'sd-list -=' shows that the new V-Vols are healthy, or until 'sd-enumerate -lt all:unhealthy' shows no SDs.</li>
<li>Use 'sd-allow-access' to license (grant the server access to) the new snapshot SDs (V-Vols).  In a script, use 'span-wait-for-loading' to wait for the resulting background processes to finish; see the man page.</li>
<li>Use 'span-add-snapshot' to enable the server to use the new snapshot, specifying a new snapshot name and the device IDs of the SDs containing the new snapshot.  (The SDs can be specified in any order.)  In a script, use 'span-wait-for-loading --mount'.</li>
<li>Use 'evsfs' to bind each file system to an EVS so that it can be mounted.  Different snapshots of the same file system can be mounted either on the same node or on different nodes, as you wish.</li>
</ul>
<p>To minimize downtime, these steps are often scripted, rather than being performed interactively.</p>
<h2>UPDATING THE CONTENTS OF A SNAPSHOT</h2>
<p>When you want to update the contents of an existing snapshot from the master copy of the span, do not use 'span-add-snapshot' again.  Instead, see 'Updating one snapshot from the contents of another' in the 'storage-based-snapshot' man page.</p>
<h1>Examples</h1>
<pre>span-add-snapshot Accounts DataMine 10-17,24-31
</pre>
<p></p>
<h1>Applies To</h1>
<p>Cluster wide</p>
<h1>See Also</h1>
<p><a href="../Supervisor/scsi-refresh.html">scsi-refresh</a> <a href="../Supervisor/sd-enumerate.html">sd-enumerate</a> <a href="../User/sd-list.html">sd-list</a> <a href="../Topic/sd-spec.html">sd-spec</a> <a href="../Supervisor/span-wait-for-loading.html">span-wait-for-loading</a> <a href="../Topic/storage-based-snapshot.html">storage-based-snapshot</a> <a href="../Topic/storage-based-snapshot-label.html">storage-based-snapshot-label</a></p>
<h1>Privilege Level</h1>
<p>Supervisor</p>
<blockquote></blockquote>
<!--End footer-->
</body>
</html>
