<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>tree-delete-job-reschedule</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
  <style type="text/css">
  <!--
  @page { size: 8.27in 11.69in }
  H1  { font-family: "Verdana", sans-serif }
  H2  { font-family: "Verdana", sans-serif }
  H3  { font-family: "Verdana", sans-serif }
  H4  { font-family: "Verdana", sans-serif }
  P   { font-family: "Verdana", sans-serif; font-size: 11pt; margin-left: 40px; }
  PRE { font-family: "Courier", monospace;  font-size: 12pt; margin-left: 40px; }
  DT  { font-family: "Verdana", sans-serif; font-size: 11pt; margin-left: 40px; }
  LI  { font-family: "Verdana", sans-serif; font-size: 11pt; margin-left: 40px; }
  -->
  </style>

</head>
<body style="background-color: white">
<!--Start header -->
<!-- html created: 2023-03-07 10:21:49 +0000 oemId: 1 -->
<h1>tree-delete-job-reschedule</h1>
<p>Submit a request to reschedule all stale jobs</p>
<h1>Syntax</h1>
<pre>tree-delete-job-reschedule [-f &lt;file-system&gt;] --errored-jobs|--user-aborted-jobs|--trash-can-jobs
Dev-level options: --jobs-causing-volume-failures
</pre>

<h1>Description</h1>
<p>Submits a request to reschedule stale jobs.</p>
<h2>What are stale jobs?</h2>
<p>When users submit a tree delete job, the server will (i) create a new directory, known as job directory, in a trash can named TRASHCAN_0 or TRASHCAN_1 in /$__TREEDELETE_TRASH__/CURRENT_JOBS/, (ii) move the directory tree to be deleted to the job directory, and (iii) add an entry for the job in the job queue.</p>
<p>A job must have an entry in the job queue to be executed. A job that is being executed or waiting in the queue is called active. A job that has a job directory on disk and is not active is called stale. Placing a stale job in the job queue to make it active is called job rescheduling.</p>
<p>Once a job is executed successfully, its job directory will be deleted. If it fails, its job directory will be moved to a special directory in /$__TREEDELETE_TRASH__ such as the following:</p>
<pre>    - ERRORED_JOBS - for jobs that failed gracefully
    - USER_ABORTED_JOBS - for jobs that were aborted by users
    - JOBS_CAUSING_VOLUME_FAILURE - for jobs that caused file system failure
</pre>
<p></p>
<p>If a file system is unmounted, the server will abort all the active jobs associated with that file system, leaving the job directories exactly where they are, i.e., in the trash cans. These jobs become stale.</p>
<p>Thus, stale jobs can be failed jobs, jobs aborted by users, or jobs aborted by file system unmount. Some stale jobs are automatically rescheduled while others are not.</p>
<h2>What stale jobs are rescheduled automatically?</h2>
<p>Stale jobs in the ERRORED_JOBS directory and the trash cans are automatically rescheduled.</p>
<p>When the file system is mounted, the server will do as follows:</p>
<pre>   1.  Move all job directories from ERRORED_JOBS back to the trash cans
   2.  Pick up a job directory in the trash cans and reschedule it
   3.  Whenever a tree delete job is completed, it will perform step 2.
       This is called the job self-submitting mechanism.
</pre>
<p></p>
<p>The self-submitting mechanism allows all stale jobs on a file system to be resubmitted for execution, one by one, without flooding the job queue. The consequences of this policy on stale jobs are as follows.</p>
<h3>Jobs aborted by unmount</h3>
<p>Because the jobs stay in the trash cans, they will be automatically rescheduled, one by one,</p>
<pre>   a. when the file system that hosts the jobs is mounted
   b. whenever a tree delete job on the file system runs to completion.
</pre>
<p></p>
<p>Thus, if a mounted file system has stale jobs and has no active jobs, the self-submitting mechanism does not work and hence the stale jobs will not be rescheduled automatically.  If this case, the user has to submit a new job to jump start the self-submitting mechanism based on rule (2). Alternatively, the user can run the tree-delete-job-reschedule command.</p>
<h3>Jobs in ERRORED_JOBS directory</h3>
<p>These jobs are automatically rescheduled at file system remount only. The user can override this behavior with the tree-delete-job-reschedule command.</p>
<h2>What stale jobs are not rescheduled automatically?</h2>
<p>By design, the following stale jobs are not rescheduled automatically:</p>
<h3>Jobs aborted by users</h3>
<p>These jobs are never rescheduled automatically. The user must use the tree-delete-job-reschedule command.</p>
<h3>Jobs that caused file system failure</h3>
<p>These jobs are never rescheduled automatically. They require customer support to investigate the root cause before they can be rescheduled.</p>
<p>Options</p>
<dl>
<dt><strong>-f, --file-system &lt;file-system&gt;</strong></dt>
<dd><p>The file system to work on. The currently selected file system is used if this option is not specified.</p></dd>
<dt><strong>--errored-jobs, -e</strong></dt>
<dd><p>Reschedule all errored jobs. This also causes all current stale jobs in the trash cans to be rescheduled. The net effect is as if the file system were unmounted and then remounted.</p></dd>
<dt><strong>--user-aborted-jobs, -u</strong></dt>
<dd><p>Reschedule all jobs in the USER_ABORTED_JOBS directory. This directory contains all jobs that were previously aborted by users. This also causes all current stale jobs in the trash cans to be rescheduled.</p></dd>
<dt><strong>--trash-can-jobs, -t</strong></dt>
<dd><p>Reschedule all stale jobs that are in the trash cans.</p></dd>
</dl>
<h1>Examples</h1>
<p>1. Reschedule all stale jobs that are in the trash cans:</p>
<pre>   $ tree-delete-job-reschedule -f fs1 --trash-can-jobs
</pre>
<p></p>
<p>2. Reschedule all errored jobs that are in the ERRORED_JOBS directory:</p>
<pre>   $ tree-delete-job-reschedule -f fs1 --errored
</pre>
<p></p>
<p>3. Reschedule all user-aborted jobs that are in the USER_ABORTED_JOBS directory:</p>
<pre>   $ tree-delete-job-reschedule -f fs1 --user-aborted-jobs
</pre>
<p></p>
<h1>Applies To</h1>
<p>File system</p>
<h1>See Also</h1>
<p><a href="../Topic/tree-delete.html">tree-delete</a> <a href="../Supervisor/tree-delete-job-abort.html">tree-delete-job-abort</a> <a href="../Supervisor/tree-delete-job-list.html">tree-delete-job-list</a> <a href="../Supervisor/tree-delete-job-status.html">tree-delete-job-status</a> <a href="../Supervisor/tree-delete-job-submit.html">tree-delete-job-submit</a></p>
<h1>Privilege Level</h1>
<p>Supervisor</p>
<blockquote></blockquote>
<!--End footer-->
</body>
</html>
