<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>tree-clone-job-submit</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
  <style type="text/css">
  <!--
  @page { size: 8.27in 11.69in }
  H1  { font-family: "Verdana", sans-serif }
  H2  { font-family: "Verdana", sans-serif }
  H3  { font-family: "Verdana", sans-serif }
  H4  { font-family: "Verdana", sans-serif }
  P   { font-family: "Verdana", sans-serif; font-size: 11pt; margin-left: 40px; }
  PRE { font-family: "Courier", monospace;  font-size: 12pt; margin-left: 40px; }
  DT  { font-family: "Verdana", sans-serif; font-size: 11pt; margin-left: 40px; }
  LI  { font-family: "Verdana", sans-serif; font-size: 11pt; margin-left: 40px; }
  -->
  </style>

</head>
<body style="background-color: white">
<!--Start header -->
<!-- html created: 2023-03-07 10:21:49 +0000 oemId: 1 -->
<h1>tree-clone-job-submit</h1>
<p>Submit a request to clone a directory tree</p>
<h1>Syntax</h1>
<pre>tree-clone-job-submit [-e] [-f &lt;file-system&gt;] &lt;source-path&gt; &lt;destination-path&gt;
</pre>

<h1>Description</h1>
<p>Submits a request to the tree cloning server to clone a directory tree. This command will return a job id if a cloning job is successfully created for the request. The job will be queued and the tree cloning server will execute it later depending on its workload. One can query the status of the job by running the command 'tree-clone-job-status' with the job id.</p>
<p>Cloning a directory tree is a two-phase process: (1) create a copy of the source tree (this copy is known as destination or target) and then (2) make each file in the destination tree a clone of the corresponding file in the source tree. Phase (1) creates target directories and target files with zero length. Phase (2) creates contents (i.e., data) of target files. For this reason phase (2) is also known as cloning data phase. For symlinks in the source directory tree, the tree cloning server creates a symlink in the destination directory with the same target path as of the source symlink. The destination directory cannot be the same as the top level directory of, or inside, the source tree. Consequently, the source tree cannot be the root directory of the file system. Both the source and destination must reside on the same file system. On failure the destination directory tree is left as is without any clean-up. On file system unmount all the active tree cloning jobs (either waiting or running) associated with the file system will be aborted; they will not be resumed when the file system is remounted.</p>
<dl>
<dt><strong>-f, --file-system &lt;file-system&gt;</strong></dt>
<dd><p>The file system to work on. The currently selected file system is used if this option is not specified.</p></dd>
<dt><strong>&lt;source-path&gt;</strong></dt>
<dd><p>The absolute path to the top-level directory of the source directory tree. This path must exist. The characters '?' and '*', if present in the path, are treated as normal characters. All components in the path must be directory names, i.e., they cannot be symlinks. The command will fail if the source directory tree has no files to clone.</p></dd>
<dt><strong>&lt;destination-path&gt;</strong></dt>
<dd><p>The absolute path to the destination directory. This path must exist. The characters '?' and '*', if present in the path, are treated as normal characters. All components in the path must be directory names, i.e., they cannot be symlinks. The destination directory must be empty; otherwise the command will fail.</p></dd>
<dt><strong>-e, --ensure-destination-path</strong></dt>
<dd><p>Ensures that the destination path exists. If the destination directory exists, it retains its existing attributes. If it does not exist, the command will do as follows:</p></dd>

<p>- create all the necessary directories in the destination path to ensure the destination path exists. If a directory component has characters '?' and/or '*' in the name, it will be created with that name exactly as is.</p>
<p>- copy all the attributes of the top-level source directory to the destination directory.</p>

<dd><p>By default, the destination directory must exist and must be empty and the command will not change its attributes.</p></dd>
</dl>
<h2>Uncloneable Files</h2>
<p>The following files are not cloneable:</p>

<p>- Files that are not regular excluding symlinks (i.e., sockets, FIFOs, block special devices, character devices).</p>
<p>- Hard links, cross volume links.</p>

<p>The tree cloning server does not treat any non-cloneable source files as error. It simply skips them, increments the skipped file counter, and logs this information in the "tree-clone" logtrace. There is only one tree-clone logtrace per physical node and its circular buffer is limited to about 1 MB.</p>
<h2>Missing Source Files/Directories</h2>
<p>There is another scenario which is not considered an error: missing source files/directories. The server does not treat this case as an error; it simply logs the missing entries in the logtrace and keeps track of the missing files/directories counters. The intention is to allow the server to continue processing the rest of the source tree so that the user can get a job status report for the entire source directory tree and take appropriate action.</p>
<p>During the cloning process a source file/directory is accessed many times. If it is found in the first access and later becomes inaccessible, it is considered missing. The file/directory is missing because another thread might have deleted it, or deleted it and recreated a new one with the same name. In both cases the original source file/directory is gone.</p>
<p>The job status report shows the total counts of skipped/missing source files/directories. It also shows the sub-counts for skipped files based on file types/features if any. Note that (i) each missing source directory is counted as one missing directory even though it may contain many files and subdirectories, and (ii) no attempt is made to clean up the targets corresponding to the missing source files/directories. If any skipped/missing file counts are nonzero, the user should run the command "logtrace dump tree-clone" to see the individual affected files and understand the root cause. If the path of a skipped file is needed, then the user can run the "object-number-to-path" command on its object number to get the path. Object numbers can be reused on object deletion so the reuse count of the current object on disk (obtained using the "onode" command) can be used to verify that the object number specified in the tree clone logtrace refers to the current object on disk.</p>
<h2>Source Tree Changing While Cloning</h2>
<p>The source directory tree is said static/dynamic if it is unchanged/changed during the tree cloning process. It is recommended that the source directory be static during cloning. But this condition might not be realistic. If the source tree keeps changing while cloning, the user must check for clone integrity in the destination tree because of the following:</p>
<p>- The cloning server processes the source tree in depth-first order. Once a sub-directory is done with cloning, it will never be revisited by the cloning server. For this reason all new files and sub-directories created in a source directory after it was done with cloning will not be seen by the cloning server and hence will not be cloned. Thus it is important to verify that all the desired cloneable files in the source tree are present in the destination directory tree.</p>
<p>- Once a file is done with cloning, it will never be revisited by the cloning server. Thus all new changes made to a source file after it is done with cloning will not be reflected in the corresponding clone in the destination tree.</p>
<h1>Examples</h1>
<p>Suppose the directory tree "project-Eagle" exists on file system "fs1" under /foo directory. To clone this tree and name the result as "project-Eagle-ver1" under /bar directory (assuming /bar does not exist), one can submit a tree clone request as follows:</p>
<pre>$ tree-clone-job-submit -f fs1 /foo/project-Eagle /bar/project-Eagle-ver1 -e
   Destination path: Cannot access "/bar".
   Will create all necessary directories in the destination path as requested...
   tree-clone: New job created, job id: bc853014-aac2-11ce-91b0-39e0822ea368
   tree-clone-job-submit: Request submitted successfully.
   tree-clone-job-submit: Job id = bc853014-aac2-11ce-91b0-39e0822ea368
</pre>
<p></p>
<p>One needs to use the job id above when querying the status of this job:</p>
<pre>$ tree-clone-job-status bc853014-aac2-11ce-91b0-39e0822ea368
</pre>
<p></p>
<p>To dump the log of skipped/missing files to the console:</p>
<pre>$ logtrace dump tree-clone
</pre>
<p></p>
<p>To get a diagnostics tarball, which contains the tree-clone logtrace in a separate file, one can run the following command over ssc:</p>
<pre>$ getdiagnostic
</pre>
<p></p>
<h1>Applies To</h1>
<p>File system</p>
<h1>See Also</h1>
<p><a href="../Topic/file-clone.html">file-clone</a> <a href="../Supervisor/getdiagnostic.html">getdiagnostic</a> <a href="../Supervisor/logtrace.html">logtrace</a> <a href="../Supervisor/object-number-to-path.html">object-number-to-path</a> <a href="../Supervisor/onode.html">onode</a> <a href="../Supervisor/tree-clone-job-abort.html">tree-clone-job-abort</a> <a href="../Supervisor/tree-clone-job-list.html">tree-clone-job-list</a> <a href="../Supervisor/tree-clone-job-status.html">tree-clone-job-status</a></p>
<h1>Privilege Level</h1>
<p>Supervisor</p>
<blockquote></blockquote>
<!--End footer-->
</body>
</html>
