<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>span-load-filesystem-cod</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
  <style type="text/css">
  <!--
  @page { size: 8.27in 11.69in }
  H1  { font-family: "Verdana", sans-serif }
  H2  { font-family: "Verdana", sans-serif }
  H3  { font-family: "Verdana", sans-serif }
  H4  { font-family: "Verdana", sans-serif }
  P   { font-family: "Verdana", sans-serif; font-size: 11pt; margin-left: 40px; }
  PRE { font-family: "Courier", monospace;  font-size: 12pt; margin-left: 40px; }
  DT  { font-family: "Verdana", sans-serif; font-size: 11pt; margin-left: 40px; }
  LI  { font-family: "Verdana", sans-serif; font-size: 11pt; margin-left: 40px; }
  -->
  </style>

</head>
<body style="background-color: white">
<!--Start header -->
<!-- html created: 2023-03-07 10:20:39 +0000 oemId: 1 -->
<h1>span-load-filesystem-cod</h1>
<p>Load fs Cod from one SD into a span; ignore other SDs&#39; fs Cod, or lack of it</p>
<h1>Syntax</h1>
<pre>span-load-filesystem-cod &lt;sd-device-id-or-span-instance-name&gt;
</pre>

<h1>Description</h1>
<p>This is a troubleshooting tool, intended for use by your support provider. It loads filesystem Cod (the filesystem catalogues and the chunk table) into memory from a single system drive (SD), ignoring filesystem Cod (or lack of it) on the other SDs in the span.  It's used when the filesystem Cod differs between SDs and so the span's filesystems won't load.</p>
<p>To determine which SD to load from, run 'span-list-filesystem-cod'.  As an alternative, you can pass 'span-load-filesystem-cod' a span instance name instead of an SD device ID.  In that case, the command will automatically find the most recent Cod on any usable SD in the span and try to load it.</p>
<p>This command is usually followed by either 'span-rewrite-cod' (to write the newly loaded Cod to all SDs in the span) or 'sd-rescan-cod &lt;span-instance-name&gt;' (to unload the filesystems, perhaps in preparation for trying another SD's filesystem Cod).</p>
<p>This command fails if the span's filesystems and chunks have been loaded.  It is intended only for loading damaged Cod</p>
<p>An equally valid way to fix inconsistent filesystem Cod is to run 'span-propagate-filesystem-cod' and then S'sd-rescan-cod &lt;span-instance-name&gt;'.  The advantage of 'span-propagate-filesystem-cod' is that it's impossible to forget to commit the repaired Cod to disk; the disadvantage is that, unless you take a single-SD Cod backup before starting work, you can't try a second version of the Cod if the first version doesn't work.</p>
<p>If it succeeds, 'span-load-filesystem-cod' queues file systems for mounting and then returns at once.  A script that needs to wait for file systems to be ready to mount (or, indeed, to be mounted immediately if the server is configured to do so) should run 'span-wait-for-loading --mount'.</p>
<h1>Examples</h1>
<p>In the following demonstration, filesystems won't load from span Accounts because SD 7 has an outdated filesystem catalogue.  This sequence of commands shows how to load the filesystems and fix the Cod:</p>
<pre>server:$ span-list accounts
Span instance name     OK?  Free  Cap/GiB  System drives                    Con
---------------------  ---  ----  -------  -------------------------------  ---
Accounts               Yes  100%       49  1,3,5,7,9                        90%
   ** This span's filesystem catalogue is unloadable: any filesystems on the
      span haven't been loaded or mounted.
</pre>
<p></p>
<pre>Run 'trouble storage' to start troubleshooting.
</pre>
<p></p>
<pre>server:$ span-list-filesystem-cod accounts fs
SD    GenNo  Timestamp              Action             Filesystem        #fs
----------------------------------------------------------------------------
9        34  20:05:52, 27 May 2008  RewriteCod         None                3
5        34  20:05:52, 27 May 2008  RewriteCod         None                3
7        31  20:03:40, 27 May 2008  RewriteCod         None                2
1        34  20:05:52, 27 May 2008  RewriteCod         None                3
3        34  20:05:52, 27 May 2008  RewriteCod         None                3
</pre>
<p></p>
<pre>See the 'span-load-filesystem-cod' and 'span-propagate-filesystem-cod' man pages
server:$ span-load-filesystem-cod 3
Success
server:$ span-list -f accounts
Span instance name     OK?  Free  Cap/GiB  System drives                    Con
---------------------  ---  ----  -------  -------------------------------  ---
Accounts               Yes   70%       49  1,3,5,7,9                        90%
  fs Alpha                UnMnt, EVS    1, cap      4, warn  90%, unconfined
  fs Beta                 UnMnt, EVS    1, cap      4, warn  90%, unconfined
  fs Gamma                UnMnt, EVS    1, cap      4, warn  90%, unconfined
</pre>
<p></p>
<pre>   ** Cod is stale and no longer reflects the span and filesystems in memory.
      Run 'span-rewrite-cod Accounts'.
fs23-1(NIM):$ span-rewrite-cod Accounts
Successfully wrote to these SDs:
1, 3, 5, 7, 9
</pre>
<p></p>
<pre>server:$ span-list -f accounts
Span instance name     OK?  Free  Cap/GiB  System drives                    Con
---------------------  ---  ----  -------  -------------------------------  ---
Accounts               Yes   70%       49  1,3,5,7,9                        90%
  fs Alpha                UnMnt, EVS    1, cap      4, warn  90%, unconfined
  fs Beta                 UnMnt, EVS    1, cap      4, warn  90%, unconfined
  fs Gamma                UnMnt, EVS    1, cap      4, warn  90%, unconfined
</pre>
<p></p>
<pre>server:$
</pre>
<p></p>
<p>Alternatively, we could have let the server find the latest Cod automatically:</p>
<pre>server:$ span-list -f accounts
Span instance name     OK?  Free  Cap/GiB  System drives                    Con
---------------------  ---  ----  -------  -------------------------------  ---
Accounts               Yes  100%       49  1,3,5,7,9                        90%
</pre>
<p></p>
<pre>   ** This span's filesystem catalogue is unloadable: any filesystems on the
      span haven't been loaded or mounted.
</pre>
<p></p>
<pre>Run 'trouble storage' to start troubleshooting.
</pre>
<p></p>
<pre>server:$ span-load-filesystem-cod accounts
Loading from SD 9
Success
fs23-1(NIM):$ span-list -f accounts
Span instance name     OK?  Free  Cap/GiB  System drives                    Con
---------------------  ---  ----  -------  -------------------------------  ---
Accounts               Yes   70%       49  1,3,5,7,9                        90%
  fs Alpha                UnMnt, EVS    1, cap      4, warn  90%, unconfined
  fs Beta                 UnMnt, EVS    1, cap      4, warn  90%, unconfined
  fs Gamma                UnMnt, EVS    1, cap      4, warn  90%, unconfined
</pre>
<p></p>
<pre>   ** Cod is stale and no longer reflects the span and filesystems in memory.
      Run 'span-rewrite-cod Accounts'.
server:$ span-rewrite-cod accounts
Successfully wrote to these SDs:
1, 3, 5, 7, 9
</pre>
<p></p>
<pre>server:$ span-list -f accounts
Span instance name     OK?  Free  Cap/GiB  System drives                    Con
---------------------  ---  ----  -------  -------------------------------  ---
Accounts               Yes   70%       49  1,3,5,7,9                        90%
  fs Alpha                UnMnt, EVS    1, cap      4, warn  90%, unconfined
  fs Beta                 UnMnt, EVS    1, cap      4, warn  90%, unconfined
  fs Gamma                UnMnt, EVS    1, cap      4, warn  90%, unconfined
</pre>
<p></p>
<pre>server:$
</pre>
<p></p>
<h1>Applies To</h1>
<p>Cluster wide</p>
<h1>See Also</h1>
<p><a href="../Topic/cod.html">cod</a> <a href="../Supervisor/sd-back-up-cod.html">sd-back-up-cod</a> <a href="../Supervisor/sd-dump-cod.html">sd-dump-cod</a> <a href="../Supervisor/sd-rescan-cod.html">sd-rescan-cod</a> <a href="../Supervisor/span-list-filesystem-cod.html">span-list-filesystem-cod</a> <a href="../Supervisor/span-propagate-filesystem-cod.html">span-propagate-filesystem-cod</a> <a href="../Supervisor/span-rewrite-cod.html">span-rewrite-cod</a> <a href="../Supervisor/span-wait-for-loading.html">span-wait-for-loading</a></p>
<h1>Privilege Level</h1>
<p>Supervisor</p>
<blockquote></blockquote>
<!--End footer-->
</body>
</html>
