<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>span-delete-all-filesystems</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
  <style type="text/css">
  <!--
  @page { size: 8.27in 11.69in }
  H1  { font-family: "Verdana", sans-serif }
  H2  { font-family: "Verdana", sans-serif }
  H3  { font-family: "Verdana", sans-serif }
  H4  { font-family: "Verdana", sans-serif }
  P   { font-family: "Verdana", sans-serif; font-size: 11pt; margin-left: 40px; }
  PRE { font-family: "Courier", monospace;  font-size: 12pt; margin-left: 40px; }
  DT  { font-family: "Verdana", sans-serif; font-size: 11pt; margin-left: 40px; }
  LI  { font-family: "Verdana", sans-serif; font-size: 11pt; margin-left: 40px; }
  -->
  </style>

</head>
<body style="background-color: white">
<!--Start header -->
<!-- html created: 2023-03-07 10:20:39 +0000 oemId: 1 -->
<h1>span-delete-all-filesystems</h1>
<p>Delete all filesystems on a span whose filesystem catalogue or chunk table is unloadable</p>
<h1>Syntax</h1>
<pre>span-delete-all-filesystems &lt;span-instance-name&gt;
</pre>

<h1>Description</h1>
<p>Deletes and recycles all filesystems on a span whose filesystem catalogue or chunk table is unloadable.  Recycles any other deleted filesystems on the span.</p>
<p>Suppose that a span has an unloadable filesystem catalogue -- the server cannot tell which filesystems are on the span.  You decide to delete the span.  The server refuses to delete a span that contains filesystems.  But you cannot delete the filesystems, because the server does not know their instance names.</p>
<p>Or suppose that a span containing multiple filesystems has a damaged chunk table.  You decide to delete the span.  To do that, you must first delete the filesystems.  But you cannot delete any filesystem, because the server does not know which chunks of disk space have become free and can be reused.</p>
<p>To break these deadlocks, use 'span-delete-all-filesystems'.  It removes all filesystems from a span, leaving you with a valid, empty filesystem catalogue, chunk table and recycle bin.  You can now either delete the span or create new filesystems on it.</p>
<p>To prevent accidental misuse, this command fails if the span's chunk table is loaded -- that is, if the server has successfully loaded filesystems and knows which chunks are allocated to each.</p>
<h2>RECLAIMING SPACE ON AN HDP POOL</h2>
<p>When you recycle a filesystem on a span that resides on an HDP pool, the server normally marks the chunks as vacated.  When other filesystems are created or expanded, vacated chunks are reallocated before any other chunks.  The 'hdp' man page explains how this mechanism prevents thinly provisioned HDP pools from running out of space prematurely.</p>
<p>However, when you run 'span-delete-all-filesystems', the server does not know which of the span's chunks are in use and which are free.  It is therefore unable to mark used chunks as vacated.  If new filesystems are created on the span, they may use chunks other than the ones that were used by the deleted filesystems.  These previously used chunks will waste space on the HDP pool.</p>
<p>If you use HDP, it is therefore advisable to carry out one of the following steps after running 'span-delete-all-filesystems':</p>
<ol>
<li>Delete the span, delete the DP-Vols, and use 'sd-forget' to remove them from the server's registry.  There is no need to delete the HDP pool or its underlying pool volumes.  You can then create new DP-Vols, expose them to the server, use 'sd-allow-access' to license them, and use 'span-create' to create a span on them.</li>
<li>Run 'span-unmap-vacated-chunks --exhaustive' on the span, and wait for all space to be unmapped before creating any new filesystems on the span.</li>
</ol>
<h1>Examples</h1>
<pre>span-delete-all-filesystems Projects
</pre>
<p></p>
<h1>Applies To</h1>
<p>Cluster wide</p>
<h1>See Also</h1>
<p><a href="../Topic/chunk.html">chunk</a> <a href="../Supervisor/filesystem-delete.html">filesystem-delete</a> <a href="../Topic/hdp.html">hdp</a> <a href="../Supervisor/sd-allow-access.html">sd-allow-access</a> <a href="../Supervisor/sd-dump-cod.html">sd-dump-cod</a> <a href="../Supervisor/sd-dump-unloadable-cod.html">sd-dump-unloadable-cod</a> <a href="../Supervisor/sd-forget.html">sd-forget</a> <a href="../Supervisor/span-create.html">span-create</a> <a href="../User/span-list.html">span-list</a> <a href="../Supervisor/span-unmap-vacated-chunks.html">span-unmap-vacated-chunks</a> <a href="../Supervisor/trouble.html">trouble</a></p>
<h1>Privilege Level</h1>
<p>Supervisor</p>
<blockquote></blockquote>
<!--End footer-->
</body>
</html>
