<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>filesystem-thin</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
  <style type="text/css">
  <!--
  @page { size: 8.27in 11.69in }
  H1  { font-family: "Verdana", sans-serif }
  H2  { font-family: "Verdana", sans-serif }
  H3  { font-family: "Verdana", sans-serif }
  H4  { font-family: "Verdana", sans-serif }
  P   { font-family: "Verdana", sans-serif; font-size: 11pt; margin-left: 40px; }
  PRE { font-family: "Courier", monospace;  font-size: 12pt; margin-left: 40px; }
  DT  { font-family: "Verdana", sans-serif; font-size: 11pt; margin-left: 40px; }
  LI  { font-family: "Verdana", sans-serif; font-size: 11pt; margin-left: 40px; }
  -->
  </style>

</head>
<body style="background-color: white">
<!--Start header -->
<!-- html created: 2023-03-07 10:20:39 +0000 oemId: 1 -->
<h1>filesystem-thin</h1>
<p>Enable, disable or view thin provisioning for one or more filesystems</p>
<h1>Syntax</h1>
<pre>filesystem-thin [&lt;filesystems-see-&#39;man fs-spec&#39;&gt; [off|on]]
</pre>

<h1>Description</h1>
<p>Enables or disables thin provisioning (TP) for one or more file systems, or reports whether TP is enabled.</p>
<p>Normally, the server reports a file system's actual capacity to protocol clients.  In other words, a user running 'df' on Unix or 'dir' on Windows will get the correct answer.</p>
<p>When TP is enabled, the server tells protocol clients that the file system has already reached the maximum capacity to which it can ever auto-expand, even while the file system is small.  This technique delays the need for the adminstrator to buy storage until it is really needed.  More formally, the server reports a capacity that is the maximum of</p>
<ul>
<li>the filesystem's current capacity, and</li>
<li>the minimum of</li>
<ul>
<li>the capacity to which you have confined the filesystem (if any), and</li>
<li>the absolute maximum capacity to which the filesystem can ever grow.</li>
</ul>
</ul>
<p>This last value -- the absolute maximum capacity to which the filesystem can ever grow -- is not accurately predictable.  It depends on how many VLSI table entries are needed by chunks added to the filesystem in the future, and that in turn depends on factors such as allocator tuning and fragmentation of the span's free chunks.  The server makes a reasonable estimate, which will change over time as the filesystem expands.  The 'chunk' man page gives background information about chunks and table entries.</p>
<p>If you confine a filesystem with 'filesystem-confine', you limit the maximum capacity that can be reported to protocol clients.  (You also limit the capacity to which the filesystem can auto-expand.)  You can later change this limit with a further 'filesystem-confine' command or with 'filesystem-release'.  It is normal for the system administrator to confine any TP filesystem to a reasonable capacity.</p>
<p>If you confine a span with 'span-confine', all its filesystems' TP capacities fall, and become equal to the filesystems' current capacities.  The change is undone when you release the span with 'span-release'.</p>
<p>If 'span-hdp-preallocation no' is in force, no filesystem auto-expansion takes place on spans that reside on HDP storage.  It becomes the administrator's responsibiliy to provision new physical storage and manually expand filesystems as necessary.  Nevertheless, unlike 'span-confine', 'span-hdp-preallocation no' does not affect the TP capacity reported to protocol clients.</p>
<p>TP does not affect the capacities reported by 'span-list --filesystems' and 'filesystem-list'.  It is, however, reflected in the output of 'filesystem-limits'.</p>
<p>TP is useful in two situations:</p>
<ul>
<li>When HDP is used, creating or expanding a filesystem will immediately pre-allocate free space for it.  Keeping the filesystem small and allowing it to auto-expand will delay this allocation until data is written and the filesystem auto-expands.  This delay enables the adminstrator to defer the purchase of new capacity, and it keeps options open in case requirements change.  Storage service providers can use filesystem-level TP to ensure that a large filesystem capacity is reported to their clients, even while the filesystem is still small.</li>
<li>TP can also be used with programs that perform free-space checks and refuse to run when the free space on the file system is low, because they were not written to take filesystem auto-expansion into account.  Reporting a larger capacity to such programs will enable them to run without requiring the administrator to allocate more space than is actually needed.</li>
</ul>
<p>TP is a per-filesystem option.  To enable or disable it, run 'filesystem-thin', specifying one or more filesystem instance names and either 'on' or 'off'.  When specifying filesystems, you can use the flexible syntax described in the 'fs-spec' man page.  However, since the filesystems are (potentially) followed by 'on' or 'off', they must be separated by slashes, rather than spaces.  To enable TP on file systems Alpha and Bravo and all file systems whose names begin with the word 'Project', write:</p>
<pre>filesystem-thin alpha/bravo/project* on
</pre>
<p></p>
<p>And not:</p>
<pre>filesystem-thin alpha bravo project* on      # SYNTAX ERROR
</pre>
<p></p>
<p>To see whether thin provisioning is enabled for a set of file systems, either run 'filesystem-thin' without specifying 'on' or 'off', or use:</p>
<pre>filesystem-list --verbose &lt;filesystems&gt;
</pre>
<p></p>
<h2>NOT TO BE CONFUSED WITH</h2>
<p>The file system-level thin provisioning (TP) managed by this command is different from the storage-level TP described in the 'hdp' man page, which provides increased flexibility at block level and enables small but efficient span-expansion.</p>
<p>This command is unrelated to 'span-hdp-thickly-provisioned', a command that rehabilitates spans that violate HDP guidelines.</p>
<h1>Examples</h1>
<pre>server:$ filesystem-thin alpha
Thin provisioning is disabled
server:$ filesystem-thin alpha/bravo/charlie
</pre>
<p></p>
<pre>Filesystem Alpha:
Thin provisioning is disabled
</pre>
<p></p>
<pre>Filesystem Bravo:
Thin provisioning is disabled
</pre>
<p></p>
<pre>Filesystem Charlie:
Thin provisioning is disabled
server:$ filesystem-thin alpha/bravo on
</pre>
<p></p>
<pre>Filesystem Alpha:
Success
</pre>
<p></p>
<pre>Use 'filesystem-confine' to limit the capacity reported to clients
</pre>
<p></p>
<pre>Filesystem Bravo:
Success
</pre>
<p></p>
<pre>Use 'filesystem-confine' to limit the capacity reported to clients
server:$ filesystem-thin alpha/bravo/charlie
</pre>
<p></p>
<pre>Filesystem Alpha:
Thin provisioning is enabled
</pre>
<p></p>
<pre>Filesystem Bravo:
Thin provisioning is enabled
</pre>
<p></p>
<pre>Filesystem Charlie:
Thin provisioning is disabled
server:$
</pre>
<p></p>
<h1>Applies To</h1>
<p>Cluster wide</p>
<h1>See Also</h1>
<p><a href="../Topic/chunk.html">chunk</a> <a href="../Supervisor/filesystem-confine.html">filesystem-confine</a> <a href="../User/filesystem-limits.html">filesystem-limits</a> <a href="../User/filesystem-list.html">filesystem-list</a> <a href="../Supervisor/filesystem-release.html">filesystem-release</a> <a href="../Topic/hdp.html">hdp</a> <a href="../Supervisor/span-confine.html">span-confine</a> <a href="../Supervisor/span-hdp-preallocation.html">span-hdp-preallocation</a> <a href="../Supervisor/span-hdp-thickly-provisioned.html">span-hdp-thickly-provisioned</a> <a href="../User/span-list.html">span-list</a> <a href="../Supervisor/span-release.html">span-release</a></p>
<h1>Privilege Level</h1>
<p>Supervisor</p>
<blockquote></blockquote>
<!--End footer-->
</body>
</html>
