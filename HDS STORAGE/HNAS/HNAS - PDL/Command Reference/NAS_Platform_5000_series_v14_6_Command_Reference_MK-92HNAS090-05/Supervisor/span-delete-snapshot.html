<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>span-delete-snapshot</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
  <style type="text/css">
  <!--
  @page { size: 8.27in 11.69in }
  H1  { font-family: "Verdana", sans-serif }
  H2  { font-family: "Verdana", sans-serif }
  H3  { font-family: "Verdana", sans-serif }
  H4  { font-family: "Verdana", sans-serif }
  P   { font-family: "Verdana", sans-serif; font-size: 11pt; margin-left: 40px; }
  PRE { font-family: "Courier", monospace;  font-size: 12pt; margin-left: 40px; }
  DT  { font-family: "Verdana", sans-serif; font-size: 11pt; margin-left: 40px; }
  LI  { font-family: "Verdana", sans-serif; font-size: 11pt; margin-left: 40px; }
  -->
  </style>

</head>
<body style="background-color: white">
<!--Start header -->
<!-- html created: 2023-03-07 10:21:49 +0000 oemId: 1 -->
<h1>span-delete-snapshot</h1>
<p>Delete one snapshot, leaving others in place</p>
<h1>Syntax</h1>
<pre>span-delete-snapshot [--retrospectively | -r] &lt;span-instance-name&gt;
</pre>

<h1>Description</h1>
<p>'span-add-snapshot' tells the server to start using a set of snapshot system drives (SDs) that an administrator has created in a storage configurator such as Storage Navigator or Hitachi Command Suite, using a product such as the Hitachi Thin Image (HTI) or Copy-On-Write (CoW) Snapshot features.  'span-delete-snapshot' tells the server to stop using these snapshot SDs.</p>
<p>Use it as part of this sequence:</p>
<ol>
<li>Unmount and optionally delete all the file systems on the snapshot.  (File systems on other snapshots of the same span can remain mounted.)</li>
<li>Use 'span-delete-snapshot' on the snapshot you wish to delete.</li>
<li>Use your storage configurator to delete the snapshot V-Vols.</li>
<li>Wait a few tens of seconds until 'sd-enumerate -lt all:unhealthy' or 'sd-list --hdp -= all:unhealthy' shows that the server has detected the deletion of the SDs.</li>
<li>Use 'sd-forget' to remove the SDs from the server's registry.  In most cases, the easiest way is 'sd-forget all:unhealthy'.</li>
</ol>
<p>If 'span-delete-snapshot' is run on a snapshot that contains filesystems, it will first attempt to delete them.  If it can't do so (because, for example, some of the file systems are mounted), the snapshot can't be deleted.  File systems can remain mounted on other snapshots and will be unaffected.</p>
<p>'span-delete-snapshot' can't be used on the original span -- the copy of the data on which 'span-enable-snapshots' was used.  It can be used only on snapshots that were configured into the server by 'span-add-snapshot'.  To identify the original span, use 'span-list-snapshots'.</p>
<p>'span-delete-snapshot' requires all other snapshots of the same span to be healthy.  It updates the Cod on those snapshots to reflect the deletion.</p>
<p>'span-delete-snapshot' does not affect the snapshot relationships configured into the storage.  To manipulate those, you must use a storage configurator, as described above.</p>
<p>To delete a span and all its snapshots, use 'span-delete-snapshot' on the snapshots and then 'span-delete' on the master copy.</p>
<p>To stop using snapshots on a span, use 'span-delete-snapshot' on all its snapshots and then 'span-disable-snapshots' on the remaining span.</p>
<p>To make the server forget about a snapshot when the snapshot SDs have already been deleted, use 'span-delete-snapshot --retrospectively'.  This is less safe than the usual procedure (running 'span-delete-snapshot' without --retrospectively before deleting the snapshot SDs) because the --retrospectively switch relaxes the usual requirement that the rest of the snapshots be Cod-writable.  Therefore, the server can't be sure that Cod on the remaining snapshots is consistent after the deletion.</p>
<p>Even if the snapshot SDs have been deleted and the cluster rebooted, so that the snapshot is not loaded into memory and doesn't show up in 'span-list', it can still be deleted with the aid of the --retrospectively switch.  This operation will remove the snapshot in question from the Cod of the other snapshots of the same span.  Use 'span-list-snapshots' to find unloaded snapshots of a specified span.  In this case, however, the server won't know which filesystems were on the deleted snapshot; you'll need to remove them from the server's registry using 'filesystem-forget-and-delete-nv-data' so that they don't occupy NVRAM space and filesystem device IDs, both of which are limited resources.</p>
<h1>Examples</h1>
<p>It's not necessary to delete file systems before deleting a snapshot, but they do have to be unmounted.  Hence:</p>
<pre>unmount Engineering-Test
unmount Marketing-Test
unmount Accounts-Test
span-delete-snapshot Departments-Test
</pre>
<p></p>
<h1>Applies To</h1>
<p>Cluster wide</p>
<h1>See Also</h1>
<p><a href="../Topic/cod.html">cod</a> <a href="../Supervisor/filesystem-forget-and-delete-nv-data.html">filesystem-forget-and-delete-nv-data</a> <a href="../Supervisor/sd-enumerate.html">sd-enumerate</a> <a href="../Supervisor/sd-forget.html">sd-forget</a> <a href="../User/sd-list.html">sd-list</a> <a href="../Supervisor/span-add-snapshot.html">span-add-snapshot</a> <a href="../Supervisor/span-disable-snapshots.html">span-disable-snapshots</a> <a href="../Supervisor/span-list-snapshots.html">span-list-snapshots</a> <a href="../Topic/storage-based-snapshot.html">storage-based-snapshot</a> <a href="../Topic/storage-based-snapshot-label.html">storage-based-snapshot-label</a></p>
<h1>Privilege Level</h1>
<p>Supervisor</p>
<blockquote></blockquote>
<!--End footer-->
</body>
</html>
