<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>migration-add-external-path</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
  <style type="text/css">
  <!--
  @page { size: 8.27in 11.69in }
  H1  { font-family: "Verdana", sans-serif }
  H2  { font-family: "Verdana", sans-serif }
  H3  { font-family: "Verdana", sans-serif }
  H4  { font-family: "Verdana", sans-serif }
  P   { font-family: "Verdana", sans-serif; font-size: 11pt; margin-left: 40px; }
  PRE { font-family: "Courier", monospace;  font-size: 12pt; margin-left: 40px; }
  DT  { font-family: "Verdana", sans-serif; font-size: 11pt; margin-left: 40px; }
  LI  { font-family: "Verdana", sans-serif; font-size: 11pt; margin-left: 40px; }
  -->
  </style>

</head>
<body style="background-color: white">
<!--Start header -->
<!-- html created: 2023-03-07 10:21:49 +0000 oemId: 1 -->
<h1>migration-add-external-path</h1>
<p>Adds an external migration path for the specified vivol/volume.</p>
<h1>Syntax</h1>
<pre>migration-add-external-path -s &lt;fs label&gt; [-v &lt;vivol&gt;] [-A] [-H] [-R] [-W] [--type &lt;type&gt;] [-u &lt;user&gt; [-p &lt;password&gt;]] -n &lt;logical name&gt; -t &lt;target&gt; [--force] [--use-ignore-file]
</pre>

<h1>Description</h1>
<p>Options:</p>
<dl>
<dt><strong>-s, --source &lt;fs label&gt;</strong></dt>
<dd><p>Source file system.</p></dd>
<dt><strong>-v, --vivol &lt;vivol&gt;</strong></dt>
<dd><p>Name of source Virtual Volume (optional).</p></dd>
<dt><strong>-W, --WORM</strong></dt>
<dd><p>Flag this target as being a system with WORM behavior (optional).</p></dd>
<dt><strong>-R, --RAIN</strong></dt>
<dd><p>Flag this target as being a system with RAIN behavior (optional).</p></dd>
<dt><strong>-A, --HCAP-archive</strong></dt>
<dd><p>Flags this target as being a Hitachi Content Archive Platform, HCAP (optional).</p></dd>
<dt><strong>-T, --type { HCAP2 | HCP-default-namespace | HCP-namespace | external-control | cloud }</strong></dt>
<dd><p>Flags this target as being of the type specified. Note that <em>--type HCAP2</em> is equivalent to <em>--HCAP-archive</em>.</p></dd>
<dt><strong>-H, --hash</strong></dt>
<dd><p>Turn on hash generation for files as they are migrated (optional).</p></dd>
<dt><strong>-n, --name &lt;logical name&gt;</strong></dt>
<dd><p>Logical name of the migration target.</p></dd>
<dt><strong>-t, --target &lt;external path URI&gt;</strong></dt>
<dd><p>Protocol specific external path.</p></dd>
<dt><strong>-F, --force</strong></dt>
<dd><p>Force the addition of the external target even when it is not accessible.</p></dd>
<dt><strong>-I, --use-ignore-file</strong></dt>
<dd><p>Attempt to find and use an ignorefile on the external target.</p></dd>
<dt><strong>-u, --user &lt;username&gt;</strong></dt>
<dd><p>Specify the <em>data access account</em> username for an HCP namespace target.</p></dd>
<dt><strong>-p, --password &lt;password&gt;</strong></dt>
<dd><p>Specify the <em>data access account</em> password for an HCP namespace target. If this option is not supplied on the command line, the command will prompt for the password interactively, in which case the password will not be echoed to the terminal.</p></dd>
</dl>
<p>Adds an external Data Migration relationship between a source file system or virtual volume and an external target storage system or list of systems. The data migration function on the SMU can then be used to copy files selected by rule from the source to the target. The source file is replaced by a cross-file-system link to the target file. This allows users to continue accessing the source file.</p>
<p>The root directory of a file system should not be used as a target for external migration as it may contain system files and directories that make it appear that the target is still in use even when it contains no migrated files.</p>
<p>The same target should not be used for multiple source file systems. Each source file system should be configured with a different target, ensuring that migrated files from different source file systems cannot be stored in the same directory on the remote server.</p>
<p>If it is required that the target file on the remote server should have the same owner and group as the source file, then the remote server should export the target file system with no root squashing.</p>
<p>Additional targets may be added using the migration-expand-external-path command.</p>
<p>When multiple targets are selected the migration will spread the migrated files amongst the targets depending on the free space available on each.</p>
<p>The migration path is also used to keep a record of the location of migrated files. If a path already exists for the source file system or virtual volume, attempts to add a new path will fail.</p>
<p>The data migration system relies on the same mechanisms as the adjoined file system feature. These two features may not be used on the same file systems.</p>
<p>The filename of the migrated file on the target will be modified with versioning information. Filename versioning causes the filename of the migrated file stored on the external target to be modified to include a time stamp based on the time of the migration operation. For example: a file "myfile.doc" would be stored on the external target as "myfile.doc.&lt;time stamp&gt;" where &lt;time stamp&gt; is the time in seconds since the beginning of 1970. The addition of the time stamp suffix limits the length of the filename for a migrated file to 244 characters. Files with filenames longer than 244 characters will therefore fail to migrate.</p>
<p>If the target is not accessible, then the command will fail unless the -F (--force) flag is specified.</p>
<h2>External Migration Target Options</h2>
<p>The -A (--HCAP-archive) and "--type HCAP2" options mark the external target as being a Hitachi Content Archive Platform (HCAP) version 2.x or earlier. When adding an HCAP device as an external target this option must be supplied in order to provide correct behaviour. If this option is supplied, the external target URI must use the HTTP protocol, and the --WORM and --RAIN options are assumed.</p>
<p>The "--type HCP-default-namespace" option marks the external target as being the <em>default namespace</em> of a Hitachi Content Platform (HCP) version 3.0 or newer. This is functionaly equivalent to "--type HCAP2" as described in the preceding paragraph, and the <em>migration-get-path</em> and <em>migration-list-paths</em> command will show both HCAP and HCP-default-namespace flags in this case.</p>
<p>The "--type HCP-namespace" option marks the external target as being an <em>HCP namespace</em> on a Hitachi Content Platform (HCP) version 3.0 or newer. If this option is supplied, the external target URI must use the HTTP protocol, a username must have been supplied with --user, and the --WORM and --RAIN options are assumed. This option must not be used for an HCP default namespace target.</p>
<p>The "--type external-control" option marks the external target as being under the control of an external migration or archival system. Targets which are configured in this way will report errors if an attempt is made to migrate files using migration by request files or the SMU's Data Migrator polices. For a list of the supported external migration and archival systems see the Administration Guide and Release Notes.</p>
<p>The "--type cloud" option marks the external target as being an external, public or private cloud that will be serviced by an internal proxy on the Linux platform.</p>
<p>The -W (--WORM) option marks the external target as being a system with WORM (write once, read many [times]) behavior. When a migration path is configured with the WORM option the resultant cross-file-system link will be created read-only.</p>
<p>The -W (--WORM) option is assumed when the target system is a Hitachi Content Archive Platform (HCAP).</p>
<p>The -R (--RAIN) option marks the external target as being a system with RAIN (redundant array of independent nodes) behavior. This should be used when the following conditions are all true for the target system:</p>
<ul>
<li>The target system is a cluster of several nodes.</li>
<li>Each node of the target system is accessed by a different IP address.</li>
<li>All files can be accessed through all nodes of the cluster using the same pathnames.</li>
<li>Each node of the cluster presents a unique NFS file-handle for a file, so the file-handle from one node cannot be used to access the same file on another node.</li>
</ul>
<p>The -R (--RAIN) option is assumed when the target system is a Hitachi Content Archive Platform (HCAP).</p>
<p>The unique failover characteristics of RAIN and HCAP targets impose certain restrictions on the specification of the migration path target as detailed in the <strong>External Path URI</strong> section below. In particular, a RAIN or HCAP target should always be configured using a symbolic hostname such as server.example.com rather than a raw IP address such as 192.168.1.1.</p>
<p>The -H (--hash) option causes a cryptographic hash of the file contents to be generated during the file transfer to the external system. The hash is calculated using the SHA-256 algorithm and is stored in an NFSv4 named attribute of the cross-file-system link after generation. The attribute is named "SHA-256".</p>
<h2>External Path URI</h2>
<p>The external path URI used with the -t (--target) option is a protocol specific URI which designates the root of the external migration path. The following sections describe the supported URI schemes.</p>
<h3>HTTP migration paths</h3>
<p>An HTTP external path is specified as follows.</p>

<p>http://server.name/path/to/root/of/archive</p>

<p>Where:</p>
<dl>
<dt><strong>http://</strong></dt>
<dd><p>Protocol specification.</p></dd>
<dt><strong>server.name</strong></dt>
<dd><p>Host name for the external HTTP server to be used as the migration target. A raw IP address, such as 192.168.1.1, must not be used as the server.name if the target has been identified as RAIN or an HCAP or HCP.</p></dd>
<dt><strong>/path/to/root/of/archive</strong></dt>
<dd><p>The pathname of the root of the archive.</p></dd>
</dl>
<h3>Cloud migration paths</h3>
<p>A cloud external path is specified as follows.</p>

<p>CloudDestinationName</p>

<p>Where:</p>

<p>CloudDestinationName is the name of an external cloud destination path configured with the migration-cloud-destination-create command. It is a pointer to a container on a cloud service that stores objects (e.g. an HCP namespace or an Amazon S3 bucket).</p>

<h3>NFS migration paths</h3>
<p>NFS connections are always made over TCP. The read and write data sizes used will be the preferred sizes provided by the NFS server as rtpref and wtpref in its FSINFO response.</p>
<p>An NFS external path is specified as follows.</p>

<p>nfs://server.name/path/to/mount</p>

<p>Where:</p>
<dl>
<dt><strong>nfs://</strong></dt>
<dd><p>Protocol specification.</p></dd>
<dt><strong>server.name</strong></dt>
<dd><p>Domain name for the external NFS server to be used as the migration target. A raw IP address, such as 192.168.1.1, must not be used as the server.name if the --RAIN option is specified.</p></dd>
<dt><strong>/path/to/mount</strong></dt>
<dd><p>The pathname of the exported mount point.</p></dd>
</dl>
<h2>Ignore file processing</h2>
<p>When adding a new target for migration a check is performed to ensure that the target directory is empty. The server already attempts to ignore common files that it may find in this remote directory, such as ".lost+found". However a more general purpose method for ignoring files in the target directory exists by specifying the --use-ignore-file option to the command and placing a specially named ignore file, ".ignore-migration", in the target directory.</p>
<p>This ignore file must be a plain text file consisting of a special section header line, "[ignorepatterns]" and followed by a sequence of key/value lines, specifying a series of shell-style wildcard patterns. These lines must have a key value of "ignore", followed by a literal '=' character and followed by a shell-style wildcard pattern.</p>
<p>The following example will match any files starting with "abc" and "bbc":</p>
<pre>[ignorepatterns]
ignore=abc*
ignore=bbc*
</pre>
<p></p>
<p>The following is the default ignore pattern used for nfs targets specified as an ignore file:</p>
<pre>[ignorepatterns]
ignore=.snapshot
ignore=$__NDMP__
ignore=$__CFN__
ignore=$__DEDUPE__
ignore=$__TREEDELETE_TRASH__
ignore=$__SMB__
ignore=lost+found
ignore=.lost+found
</pre>
<p></p>
<p>The ignore file name itself is automatically added to the list of shell-style wildcard patterns.</p>
<p>Note that the pattern matching code does not understand multi-byte UTF-8 characters, so the use of '?' to match a single character and the use of character ranges may not work as expected.</p>
<h2>Access time based policy rules</h2>
<p>Note: the use of an ACTIVE_WITHIN directive within a migration policy rule requires that access time maintenance has been enabled on the file system. See fs-accessed-time.</p>
<h1>Examples</h1>
<pre>migration-add-external-path -s fs1 -n HCAP1 --HCAP-archive -t http://hcap.example.com/fcfs_data/example_archive
</pre>
<p></p>
<p>Creates a migration path from file system fs1 to the /fcfs_data/example_archive directory within the HCAP at hcap.example.com, and gives this target the name "HCAP1".</p>
<pre>migration-add-external-path -s fs1 -n Archive1 -t nfs://archive.example.com/fcfs_data/example_archive
</pre>
<p></p>
<p>Creates a migration path from file system fs1 to the /fcfs_data/example_archive mount point on archive.example.com, and gives this target the name "Archive1".</p>
<pre>migration-add-external-path -s Accounts -v HR -n "HR archive" -t nfs://archive.example.com/fcfs_data/HR_archive
</pre>
<p></p>
<p>Creates a migration path from virtual volume HR on file system Accounts to the /fcfs_data/HR_archive on archive.example.com with the logical name "HR archive".</p>
<pre>migration-add-external-path -s fs2 -n Archive1 -W -R -H -t nfs://archive.example.com/fcfs_data/example_archive
</pre>
<p></p>
<p>Creates a migration path from file system fs2 to the /fcfs_data/example_archive mount point on archive.example.com with the logical name "Archive1", and specifies that the target is a WORM file-system on a RAIN cluster and that a hash of the file contents should be created during migration.</p>
<pre>migration-add-external-path -s fs0 -n Namespace1 --type HCP-namespace --user myuser -t http://namespace-1.tenant-1.hcp.example.com/rest/archive
</pre>
<p></p>
<p>Creates a migration path from file system fs0 to the /rest/archive mount point on the "namespace-1" HCP namespace on hcp.example.com with the logical name "namespace1". The data access account to be used is specified as user "myuser" and the command will prompt for the password.</p>
<pre>migration-add-external-path -s fs0 -n CloudDestination -t CloudDestination --type cloud
</pre>
<p></p>
<p>Creates a migration path from file system fs0 to the cloud destination CloudDestination and gives this target the logical name "CloudDestination". Cloud destination should be created with migration-cloud-destination-create command. Path name and target options have to be the same.</p>
<h1>Applies To</h1>
<p>EVS</p>
<h1>See Also</h1>
<p><a href="../Supervisor/fs-accessed-time.html">fs-accessed-time</a> <a href="../Supervisor/migration-change-external-path.html">migration-change-external-path</a> <a href="../Supervisor/migration-cloud-destination-create.html">migration-cloud-destination-create</a> <a href="../Supervisor/migration-delete-external-path.html">migration-delete-external-path</a> <a href="../Supervisor/migration-expand-external-path.html">migration-expand-external-path</a> <a href="../Supervisor/migration-get-dependencies.html">migration-get-dependencies</a> <a href="../Supervisor/migration-get-path.html">migration-get-path</a> <a href="../Supervisor/migration-list-paths.html">migration-list-paths</a> <a href="../Supervisor/migration-update-paths.html">migration-update-paths</a> <a href="../Topic/mount-point-access-configuration.html">mount-point-access-configuration</a> <a href="../User/nfs-export.html">nfs-export</a></p>
<h1>Privilege Level</h1>
<p>Supervisor</p>
<blockquote></blockquote>
<!--End footer-->
</body>
</html>
