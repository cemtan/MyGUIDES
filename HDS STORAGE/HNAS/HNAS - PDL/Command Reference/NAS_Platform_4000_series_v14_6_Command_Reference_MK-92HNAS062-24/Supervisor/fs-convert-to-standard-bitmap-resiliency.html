<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>fs-convert-to-standard-bitmap-resiliency</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
  <style type="text/css">
  <!--
  @page { size: 8.27in 11.69in }
  H1  { font-family: "Verdana", sans-serif }
  H2  { font-family: "Verdana", sans-serif }
  H3  { font-family: "Verdana", sans-serif }
  H4  { font-family: "Verdana", sans-serif }
  P   { font-family: "Verdana", sans-serif; font-size: 11pt; margin-left: 40px; }
  PRE { font-family: "Courier", monospace;  font-size: 12pt; margin-left: 40px; }
  DT  { font-family: "Verdana", sans-serif; font-size: 11pt; margin-left: 40px; }
  LI  { font-family: "Verdana", sans-serif; font-size: 11pt; margin-left: 40px; }
  -->
  </style>

</head>
<body style="background-color: white">
<!--Start header -->
<!-- html created: 2023-03-05 07:29:14 +0000 oemId: 1 -->
<h1>fs-convert-to-standard-bitmap-resiliency</h1>
<p>Convert a WFS-2 file system&#39;s free space bitmap to support standard bitmap resiliency</p>
<h1>Syntax</h1>
<pre>fs-convert-to-standard-bitmap-resiliency -f &lt;file system&gt; [--abort|-a] [--dont-mount-on-success]
Dev-level options: [--sync|-s]
</pre>

<h1>Description</h1>
<p>This command converts an existing WFS-2 file system with enhanced bitmap resiliency to standard bitmap resiliency.</p>
<p>If the conversion was aborted, it is recommended that checkfs be run immediately after abort to check the file system integrity before attempting to run any of these commands: fs-convert-to-support-dedupe, fs-convert-to-standard-bitmap-resiliency, or fs-convert-to-enhanced-bitmap-resiliency.</p>
<p>WFS-2 file systems were always formatted with enhanced bitmap resiliency in release 12.5 and earlier. Starting with release 12.6 they can be formatted with either standard or enhanced bitmap resiliency.  We think file systems on HDP storage do not benefit from enhanced bitmap resiliency; formatting them with standard bitmap resiliency offers a performance advantage. Thus, the default is to format file systems with standard bitmap resiliency on HDP storage, and with enhanced bitmap resiliency on other storage.  The default can be overridden with the --force-{standard|enhanced}-bitmap-resiliency dev-level options.</p>
<p>There are two ways to obtain standard bitmap resiliency:</p>

<p>1. Run the 'format' command as a dev user with --force-standard-bitmap-resiliency option (run 'help format' as dev user for more information), or</p>
<p>2. Run the 'fs-convert-to-standard-bitmap-resiliency' command on an existing WFS-2 file system.</p>

<h2>Highlights</h2>
<ul>
<li>If the conversion fails for any reason, all changes will be discarded as if the command were never run and, hence, the free space bitmap resiliency mode remains unchanged.</li>
<li>The bitmap resiliency conversion is reversible.</li>
<li>Up to 5 file systems can be converted in parallel per physical node, any additional conversion requests beyond this limit will be queued. Depending on the size of the file system the conversion process can take a few minutes to a few hours. Use 'utility-progress' to view the status of in-progress conversions and 'fs-show-queued-tasks' to view queued conversions.</li>
<li>Before downgrading to release 12.5 or earlier, all file systems with standard bitmap resiliency must be converted to enhanced bitmap resiliency. Otherwise, they cannot be mounted after downgrade.</li>
</ul>
<h2>Restrictions</h2>
<p>The following restrictions apply for a conversion to succeed:</p>
<dl>
<dt><strong>The file system should be in unmounted state.</strong></dt>
<dd><p>Use 'filesystem-list' command to check the state of file system.</p></dd>
<dd><p>To fix: unmount the file system. (See 'unmount' command.)</p></dd>
<dt><strong>The file system must have sufficient space.</strong></dt>
<dd><p>The conversion of a file system will fail if there isn't sufficient free space. In such cases, the space required for the conversion will be reported in the dblog and dynamic log. In general, conversion to standard bitmap resiliency requires an amount of free space to be about 4 times the data length of the current free space bitmap.</p></dd>
<dd><p>To fix: Create more free space, e.g. by deleting snapshots or by expanding the file system size, before re-submitting the conversion.</p></dd>
<dt><strong>The file system should not have any object-based snapshots.</strong></dt>
<dd><p>Use 'snapshot-list' to check whether the file system has any object-based snapshots.</p></dd>
<dd><p>To fix: Delete any existing object-based snapshots (see 'snapshot-delete-all' or 'kill-snapshots'), and wait for the snapshot deletion to complete before re-submitting the conversion.</p></dd>
<dt><strong>No snapshot operation can be pending on the file system.</strong></dt>
<dd><p>This can happen if the file system is rolled back to a snapshot and then a conversion is requested immediately after the rollback.</p></dd>
<dd><p>To fix: Mount the file system in read-write mode in order to complete the snapshot operation before re-submitting the conversion.</p></dd>
<dt><strong>The file system must have at least 16 dynamic super-blocks (DSBs)</strong></dt>
<dd><p>Check the "FS Type" column in the output of the 'df' command.</p></dd>
<dd><p>To fix: Increase the number of DSBs using 'fs-set-dsb-count' before re-submitting the conversion.</p></dd>
</dl>
<p>Options:</p>
<dl>
<dt><strong>-f, --filesystem &lt;file system&gt;</strong></dt>
<dd><p>Specify the name of the file system to be converted. The name is mandatory. Only WFS-2 file systems are supported.</p></dd>
<dt><strong>-a, --abort</strong></dt>
<dd><p>This option aborts the conversion of a file system if it's in progress or queued.</p></dd>
<dt><strong>--dont-mount-on-success</strong></dt>
<dd><p>By default, the file system will be automatically mounted after a successful bitmap conversion. Use this option to prevent the file system from being mounted automatically after a successful conversion.</p></dd>
</dl>
<h1>Examples</h1>
<p>1. Show the free space bitmap resiliency of a file system:</p>
<pre>      server:$ fs-show-bitmap-resiliency fs1
      fs-show-bitmap-resiliency/fs1: File system has enhanced bitmap resiliency
      fs-show-bitmap-resiliency/fs1: Data length           : 1.598 MB (1675264 B) or 409 blocks
      fs-show-bitmap-resiliency/fs1: Total blocks consumed : 818
</pre>
<p></p>
<p>2. Convert a WFS-2 file system to standard bitmap resiliency:</p>
<pre>      server:$ fs-convert-to-standard-bitmap-resiliency -f fs1
      server:$ fs-show-bitmap-resiliency fs1
      fs-show-bitmap-resiliency/fs1: File system has standard bitmap resiliency
      fs-show-bitmap-resiliency/fs1: Data length           : 1.598 MB (1675264 B) or 409 blocks
      fs-show-bitmap-resiliency/fs1: Total blocks consumed : 409
</pre>
<p></p>
<p>3. No conversion will be performed if the file system already has the intended resiliency:</p>
<pre>      server:$ fs-convert-to-standard-bitmap-resiliency -f fs1
      fs-convert-to-standard-bitmap-resiliency: File system 'fs1' already has standard bitmap resiliency
</pre>
<p></p>
<p>4. How to fix pre-mount processing error?</p>
<pre>      server:$ fs-convert-to-standard-bitmap-resiliency -f fs4
      fs-convert-to-standard-bitmap-resiliency: Error: Bitmap resiliency of file system ('fs4') cannot be changed. The file system must have completed its pre-mount processing
</pre>
<p></p>
<p>The fix is to mount with option --pre-mount-only:</p>
<pre>      server:$ mount --pre-mount-only fs4
      server:$ fs-convert-to-standard-bitmap-resiliency -f fs4 --remove-resiliency
      . . . . . . . (lines omitted for brevity) . . . . . . . .
      fs-convert-to-standard-bitmap-resiliency/fs4: Successfully converted to standard bitmap resiliency.
      . . . . . . . (lines omitted for brevity) . . . . . . . .
</pre>
<p></p>
<h1>Applies To</h1>
<p>File system</p>
<h1>See Also</h1>
<p><a href="../Supervisor/format.html">format</a> <a href="../Supervisor/fs-convert-to-enhanced-bitmap-resiliency.html">fs-convert-to-enhanced-bitmap-resiliency</a> <a href="../Supervisor/fs-convert-to-support-dedupe.html">fs-convert-to-support-dedupe</a> <a href="../Dev/fs-show-bitmap-resiliency.html">fs-show-bitmap-resiliency</a> <a href="../Supervisor/fs-show-queued-tasks.html">fs-show-queued-tasks</a> <a href="../Supervisor/kill-snapshots.html">kill-snapshots</a> <a href="../Supervisor/snapshot-delete-all.html">snapshot-delete-all</a> <a href="../User/snapshot-list.html">snapshot-list</a> <a href="../Supervisor/unmount.html">unmount</a> <a href="../Supervisor/utility-progress.html">utility-progress</a></p>
<h1>Privilege Level</h1>
<p>Supervisor</p>
<blockquote></blockquote>
<!--End footer-->
</body>
</html>
