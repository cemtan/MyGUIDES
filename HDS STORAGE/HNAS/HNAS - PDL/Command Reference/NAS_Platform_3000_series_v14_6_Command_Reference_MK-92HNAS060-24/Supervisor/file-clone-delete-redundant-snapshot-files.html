<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>file-clone-delete-redundant-snapshot-files</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
  <style type="text/css">
  <!--
  @page { size: 8.27in 11.69in }
  H1  { font-family: "Verdana", sans-serif }
  H2  { font-family: "Verdana", sans-serif }
  H3  { font-family: "Verdana", sans-serif }
  H4  { font-family: "Verdana", sans-serif }
  P   { font-family: "Verdana", sans-serif; font-size: 11pt; margin-left: 40px; }
  PRE { font-family: "Courier", monospace;  font-size: 12pt; margin-left: 40px; }
  DT  { font-family: "Verdana", sans-serif; font-size: 11pt; margin-left: 40px; }
  LI  { font-family: "Verdana", sans-serif; font-size: 11pt; margin-left: 40px; }
  -->
  </style>

</head>
<body style="background-color: white">
<!--Start header -->
<!-- html created: 2023-03-07 10:20:39 +0000 oemId: 1 -->
<h1>file-clone-delete-redundant-snapshot-files</h1>
<p>Delete snapshot-files that are not utilised by a file system&#39;s extant file clones</p>
<h1>Syntax</h1>
<pre>file-clone-delete-redundant-snapshot-files [--dry-run] &lt;file-system&gt;
</pre>

<h1>Description</h1>
<p>This command queues a background task that walks across the specified file system and schedules the background deletion of redundant "Snapshot File" objects that may have been left behind by server software earlier than SU 11.3.3450 or fixfs.  An event will be logged when the task completes.</p>
<p>The task queue is not persistent and unmounting a file system will remove its task (if any) from the queue.</p>
<p>The background task will fail if there are files currently queued for background deletion.  Retry when the "df" command reports there is nothing queued for deletion.</p>
<dl>
<dt><strong>-d, --dry-run</strong></dt>
<dd><p>Do not schedule the deletion of any redundant Snapshot File objects, the completion event will just report the number of such objects that are present on the file system.</p></dd>
</dl>
<h1>Examples</h1>
<p>To queue the file system "fs0":</p>
<pre>$ file-clone-delete-redundant-snapshot-files fs0
</pre>
<p></p>
<p>The following event will be logged if the background task completes successfully:</p>
<pre>Information: File System: Redundant Snapshot File scan on file system fs0 has completed successfully (10 objects scheduled for background deletion).
</pre>
<p></p>
<p>If the background task fails an event will be logged with the failure reason, e.g.</p>
<pre>Warning: File System: Redundant Snapshot File scan on file system fs0 has failed (0 objects scheduled for background deletion). Reason: Background delete queue not empty - cannot perform background deletion of Snapshot Files.
</pre>
<p></p>
<p>In this particular case we must wait for the file system's background delete queue to empty before retrying.  The "df" command reports "queued for deletion" whilst that queue is not empty, e.g.</p>
<pre>$ df
</pre>
<p></p>
<pre>  ID  Label     Size                                         Used  Snapshots  Reduction         Avail  Thin              FS Type
----  -----  -------  -------------------------------------------  ---------  ---------  ------------  ----  -------------------
1025    fs0  3.97 GB  3.14 GB (79%) (8.63 MB queued for deletion)   0 B (0%)         NA  845 MB (21%)    No  4 KB,WFS-2,128 DSBs
</pre>
<p></p>
<h1>Applies To</h1>
<p>File system</p>
<h1>See Also</h1>
<p><a href="../User/df.html">df</a> <a href="../Topic/file-clone.html">file-clone</a> <a href="../Dev/fixfs.html">fixfs</a></p>
<h1>Privilege Level</h1>
<p>Supervisor</p>
<blockquote></blockquote>
<!--End footer-->
</body>
</html>
